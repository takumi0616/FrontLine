# データ駆動型メソスケール天気予報：Swin‑Unet と拡散モデルの統合（Predictor–Corrector 枠組み）

（原題）Data-driven Mesoscale Weather Forecasting Combining Swin-Unet and Diffusion Models

著者:

- 平林 雄太 (Yuta Hirabayashi)¹
- 松岡 大輔 (Daisuke Matsuoka)¹

所属:

- ¹ 海洋研究開発機構 (JAMSTEC), 横浜, 日本

連絡先: yuta.hirabayashi@jamstec.go.jp

メタ情報:

- arXiv: 2503.19354v1 [cs.LG]
- 日付: 2025 年 3 月 25 日
- 掲載先: manuscript submitted to Enter journal name here（投稿中）

---

## キー・ポイント

- Swin‑Unet を決定論的な予測器（Predictor）、拡散モデルを確率論的な修正器（Corrector）として組み合わせたメソスケール天気予報モデルを提案。
- Predictor と Corrector は独立に学習されるため、Corrector を再学習せずに Predictor を柔軟に更新可能。
- 提案手法は高空間周波数成分を強化し、強い降水の予測精度を改善。

---

## 要旨（Abstract）

データ駆動型の天気予測モデルは有望な性能を示し継続的に進歩している。特に拡散モデルは、空間的な平滑化を伴わずに微細スケールの詳細を表現でき、豪雨などのメソスケール予測にとって重要である。しかし、拡散モデルのメソスケール予測への応用は依然として限定的である。本研究は、このギャップに対処するため、決定論的モデルとしての Swin‑Unet と拡散モデルを組み合わせ、柔軟性を保ちながらメソスケール予測を達成するアーキテクチャを提案する。本アーキテクチャでは両モデルを独立に学習し、決定論的モデルの更新時にも拡散モデルを変更しないことを可能にする。Fractions Skill Score（FSS）とパワースペクトル解析による比較の結果、拡散モデルの導入により、導入しない場合と比べて精度が向上することを示した。これらの知見は、特に強い降水事象において、柔軟性を維持しながらメソスケール予測を強化し得る本アーキテクチャの可能性を示している。

---

## やさしい要約（Plain Language Summary）

近年の人工知能の進展により、データ駆動型の天気予測モデルは、従来の数値天気予報（NWP）モデルに匹敵するまでに発展した。その中でも拡散モデルは、微細な構造を保ったまま現実的な天気パターンを生成できることから注目され、豪雨などのメソスケール現象の予測に有用である。本研究では、時間発展を担う Swin‑Unet と、微細スケールの補正を担う拡散モデルを統合したメソスケール天気予報のアーキテクチャを提案する。両者を独立に学習することで、拡散モデルを再学習することなく予測モデルを柔軟に更新できる。本アプローチは微細構造の表現を強化し、強い降水の予測精度を向上させる。

---

## 1. はじめに（Introduction）

メソスケール現象（豪雨を含む）の精度の高い予測は不可欠である。メソスケールは総観（~1000 km, ~1 日）と三次元乱流（~100 m, ~1 分）の中間スケールを指す（Orlanski, 1975; Craig & Selz, 2018）。前線、スコールライン、メソスケール対流系（Craig & Selz, 2018）などが例であり、しばしば豪雨を伴い（Houze, 2004; Schumacher & Johnson, 2005）、大きな災害を引き起こす。現象の正確な予測は事前の周知を通じて被害軽減に資する。これを実現するために、高解像度の数値天気予報（NWP）モデルが重要である。たとえば、気象庁は局地豪雨による災害の軽減に向けた地域メソスケールモデルを運用している（Ishida et al., 2022）。これらのモデルは高解像度格子上で偏微分方程式を数値的に解くが、空間解像度の向上は著しい計算コストを伴う。

一方、データ駆動型の天気予測モデルは、計算コストを削減しつつ高精度を達成する可能性から注目を集めている。これらは再解析データセットで学習された高度な機械学習を用いて気象変数の時間発展を模擬し、GPU や TPU を活用して計算効率を高める（Lam et al., 2023; Bi et al., 2023）。例として GraphCast（Lam et al., 2023）は、単一の TPU で全球 0.25° 解像度の 10 日予報を 1 分未満で生成し、RMSE で IFS を多くの変数で上回った。平均誤差（RMSE）以外にも、物理的実在性などの観点からデータ駆動型モデルが検討されている（Bonavita, 2024; Charlton‑Perez et al., 2024; Bouallègue et al., 2024）。Bonavita (2024) は、Pangu‑Weather（Bi et al., 2023）の予報スペクトルが約 500–700 km より細かい波長でエネルギーが低いことを示し、データ駆動型モデルがメソスケール予測に重要な微細スケールの特徴表現に弱いことを示唆した。これは、しばしば平均二乗誤差（MSE）を損失として決定論的に学習されることに起因し、確率論的アプローチが有効である可能性を示す。

拡散モデル（Ho et al., 2020; Song et al., 2021）は、学習データの確率分布に従うサンプル生成能力から、微細スケール表現を可能にしうる。拡散モデルは、高次元データをガウス雑音に変換する「拡散」と、ガウス雑音からデータ分布を近似してサンプルを生成する「逆拡散」の二過程からなる。気象予測への応用としては、直前時刻の変数に条件づけて気象変数を生成する手法（GenCast; Price et al., 2025）と、時間発展を担う決定論的 ML モデルの出力を拡散モデルで補正する手法（ArchesWeatherGen; Couairon et al., 2024）がある。前者は単純、後者は拡散モデルが低コストで収束しやすく最先端の決定論的モデルを活用できる利点がある（Couairon et al., 2024; Mardani et al., 2025; Finn et al., 2024）。ArchesWeatherGen はトランスフォーマベースの決定論モデルに拡散モデルを組み合わせ、決定論のみの場合に比べ再解析に近いパワースペクトルを示した。GenCast と ArchesWeatherGen は全球 0.25° 再解析を学習しておりメソスケール情報の獲得には限界があるが、拡散モデルの微細スケール表現能力はメソスケール予測への適用可能性を示唆する。

メソスケール予測への拡散モデル適用の研究はまだ限られるが、例外として StormCast（Pathak et al., 2024）があり、U‑Net を決定論モデルとする拡散モデルの組み合わせで、対流クラスタの発達などメソスケール現象の予測可能性を示した。これは全球予報のみならずメソスケール予測にも有望である一方、決定論モデルの調整のたびに拡散モデルの再学習が必要となる柔軟性の欠如がある。これは、拡散モデルが決定論モデルの出力と真値の対を含むペアデータで学習されるためである。真値のみからなる非ペアデータで拡散モデルを独立に学習できるアーキテクチャは、柔軟性と広い適用性を提供し得る。

本研究は、決定論的 Predictor としてのトランスフォーマベースモデル（本研究では Swin‑Unet）と、確率論的 Corrector としての拡散モデルを組み合わせ、モデル構成と更新の柔軟性を保ちながらメソスケール予測を可能にするアーキテクチャを提案する。これは、非ペアデータで訓練した拡散ブリッジにより低解像度から高解像度へ変換するダウンスケーリング（Bischoff & Deck, 2024）を拡張し、Predictor の出力を彼らの低解像度データに相当とみなすもので、StormCast の柔軟性の拡張とも位置づけられる。本研究の目的は、このアーキテクチャが柔軟性を保ちつつメソスケール予測性能を向上できるかを明らかにすることである。

---

## 2. データと手法（Data and Methods）

データは地域気候ダウンスケーリングデータセット RCDSJRA‑55（Kawase et al., 2023）から前処理とサンプリングで作成した。同データは DS20km（格子間隔 20 km）と DS5km（5 km）の 2 解像度があり、本研究では DS5km を使用した。入力特徴として地表 5 変数、真値として高層 5 変数を用いた。地表変数は地上 1.5 m 気温、地上 10 m の東西風（u）・南北風（v）、海面更正気圧、総降水量。高層変数は 200, 300, 500, 700, 850, 925, 1000 hPa における気温、u・v 風、ジオポテンシャル高度、露点温度差。訓練・検証・評価には 00, 06, 12, 18 UTC を用い、水平格子は原データ（527×804）から中央 512×768 を抽出した（図 1）。全変数は予測モデル用に正規化した。

図 2 に示すように、Swin‑Unet（Cao et al., 2021; Fan et al., 2022）を決定論的 Predictor、拡散モデルを確率論的 Corrector として統合した。Swin‑Unet は次時刻の期待値を予測し、拡散モデルは残差を確率的に調整して高空間周波数構造を強化する。Swin‑Unet は Swin Transformer ベースのブロックを用いた U 字型のアーキテクチャで、Vision Transformer（Dosovitskiy et al., 2020）の拡張である。SwinTransformer V2（Liu et al., 2021）を採用し基本埋め込み次元 96、ウィンドウサイズ 4。チェッカーボードアーティファクトを防ぐため、双方式アップサンプル（バイリニア + サブピクセル、Shi et al., 2016; Fan et al., 2022）を採用し、他のパラメータは Cao et al. (2021) に準拠した。拡散モデルは確率微分方程式（SDE）でデータ分布を学習し、Dhariwal & Nichol (2021) の U‑Net 系を基に、エンコーダ/デコーダ各 4 層、基本埋め込み次元 64、各解像度で 2 残差ブロック、チャネル倍率 [1, 2, 2, 2]、注意機構なし（Bischoff & Deck, 2024 に同じ）。学習手順とハイパラは Karras et al. (2022) に準拠し、学習時間と GPU メモリ削減のため一部調整した。

Predictor と Corrector は独立に学習した。Predictor は 6 時間間隔のペアデータで MSE を最小化するよう学習し、現時刻から 6 時間先を予測する。Corrector は非ペアデータでデータ分布近似を学習した。両モデルともエポック 400、バッチサイズ 16、GPU は NVIDIA A100（40 GB）×8。最適化は Predictor が Adam（学習率 5×10⁻⁴、weight decay 3×10⁻⁶）、Corrector が AdamW（学習率 1×10⁻⁴, β₁=0.9, β₂=0.99）。学習では AMP（自動混合精度）を用いた。

予測段階では、Predictor で 6 時間先を生成し、Corrector で補正アンサンブルを得た。Corrector は、ダウンスケーリング（Bischoff & Deck, 2024; Hess et al., 2024）の概念に倣い、Predictor 出力にガウス雑音を加えたものに逆拡散を適用する。Bischoff & Deck (2024) に従い、雑音レベル σ は次式で計算した：

```
σ² = N · PSD(k)  (1)
```

ここで k は波数、N は x 方向格子数、PSD は各正規化変数のパワースペクトル密度（x 方向にフーリエ変換し y 方向に平均）。k は、Predictor のパワースペクトルが真値のパワースペクトルから一定割合だけ低下する点として各変数で決定した。この割合はハイパラで、Corrector の影響を制限すると小さく、過大にすると Predictor の低周波構造が崩壊するトレードオフから 0.1 に設定した（Bischoff & Deck, 2024）。その後、各変数の σ を式(1)で最適化し、逆拡散で用いる σ は中央値とした。これにより、Predictor の低周波（波数 < k）構造は保持され、高周波成分は拡散モデルで確率的に補完される。σ 最適化は検証データで行った。最後に、上記 σ に対して乱数雑音を変化させアンサンブル（サイズ 16）を生成し、逆拡散の生成ステップは 20（StormCast は 18）とした。

検証では、同一データで学習した Predictor 単体と Predictor–Corrector の精度を比較した。学習期間は 2000–2015 年（16 年）、検証は 2016–2018 年（3 年）、テストは 2019 年（1 年）。学習後、検証データで σ=2.148 を得てテストに用いた。降水は Roberts & Lean (2008) による Fractions Skill Score（FSS）を Mittermaier (2021) の式(2)で各空間スケールに対して算出した。さらに StormCast（Pathak et al., 2024）に倣い、確率整合平均（PMM; Ebert, 2001）でアンサンブル降水を集約し、FSS は PMM 後の結果で評価した。他の変数は、Predictor–Corrector のアンサンブル平均 RMSE と Predictor 単体の RMSE を比較した。パワースペクトルは x 方向フーリエ・y 方向平均で空間周波数ごとの性能を評価した。なお、図 1 の領域から y 方向上端・下端の 5 格子を、拡散モデル由来のノイズのため除外した。
FSS の定義（Mittermaier, 2021; Clark, 2017 参照）：

```
⟨FSS(n)⟩ = 1 −
{
  ∑_{k=1}^{Nt} [ ∑_{i=1}^{Nx} ∑_{j=1}^{Ny} (F_{(n),ij} − O_{(n),ij})^2 ]_k
} /
{
  ∑_{k=1}^{Nt} [ ∑_{i=1}^{Nx} ∑_{j=1}^{Ny} F_{(n),ij}^2 ]_k
+ ∑_{k=1}^{Nt} [ ∑_{i=1}^{Nx} ∑_{j=1}^{Ny} O_{(n),ij}^2 ]_k
}
                                              (2)
```

ここで F, O は近傍サイズ n に対する空間分率、Nt は予報本数、Nx, Ny は格子数。

---

## 図 1

RCDSJRA‑55 の再解析データ例（本研究で水平方向中央 512×768 を抽出後）。左から順に総降水、1.5 m 気温、850 hPa 露点温度差。対象領域は日本および周辺域。

---

## 図 2

Swin‑Unet を Predictor、拡散モデルを Corrector とする Predictor–Corrector 枠組みの概略。時刻 t の状態から Swin‑Unet が t+6h を予測。予測値にガウス雑音を加え Corrector（拡散モデル）に入力し、逆拡散を通じて予測の高周波成分を確率的に補正し、補正アンサンブルを生成。

---

## 3. 結果（Results）

図 3 は 2019 年 10 月 25 日 00:00UTC における豪雨事例で、降水、風、925 hPa の混合比に関して Corrector の有無を比較する。日本の東海上の台風と本州南海上の低気圧の影響下で、Predictor–Corrector は最大降水を真値に近づけた。最大値は Predictor–Corrector で 63.1 kg m⁻² h⁻¹、Predictor 単体で 55.6、真値は 83.5。下段の風と水蒸気輸送は両モデルで顕著であり、図 3 の赤楕円領域において Predictor–Corrector は混合比の収束がより明瞭である。

図 4 は同時刻の各気象変数の比較で、Predictor–Corrector のアンサンブルからランダムに抽出したメンバー（Ens‑Sample）は、Predictor 単体とアンサンブル平均（Ens‑Mean）より微細構造が豊かで、特に地上・1000 hPa の u, v 成分風、850 hPa の露点温度差で顕著である。例えば v 風では、赤楕円領域において Ens‑Sample と真値に強い構造が見られるが、Predictor 単体と Ens‑Mean では空間的に平滑化されている。一方、500 hPa の気温やジオポテンシャル高度では微細構造が少なく、差は小さい。

図 5 は FSS を空間スケールと降水閾値（1, 10, 20, 30, 40, 50 kg m⁻² h⁻¹）で比較したもので、特に 20 と 30 の閾値で、広い空間スケールにおいて Predictor–Corrector が一貫して高い FSS を示す。例えば 100 km スケールで FSS は 0.200（Predictor）に対し 0.248（Predictor–Corrector）で、24% の改善。位置の予測精度には限界が残るが、強降水事象の予測性能向上を示す。

図 6 は各変数のパワースペクトルの改善を示す。500 km より細かいスケール（図中 2×10⁻³ [km⁻¹] の赤線）で、Predictor–Corrector は真値に近づき、Predictor 単体で見られた小スケールでのパワー低下を緩和した。地表・1000 hPa の u, v 風、1000 hPa の露点温度差で顕著で、図 4 の観察と整合する。

図 7 は RMSE の比較で、地表・925・1000 hPa の u, v 風および露点温度差に関して、Predictor–Corrector のアンサンブル平均 RMSE は Predictor 単体の RMSE と同等。一方、その他の気圧面や変数では Predictor–Corrector が劣る。これは高周波成分の強化が顕著な変数・層で改善が見られること（図 6）と一致する。

---

## 4. 議論と結論（Discussion and Conclusions）

図 5 の FSS と図 6 のパワースペクトル解析から、Corrector は実効解像度を高め、降水精度を改善することが示された。Predictor 単体の空間平滑化傾向は、全球シミュレーションのデータ駆動型モデルの特性（Bonavita, 2024）や極端事象強度の過小評価（Charlton‑Perez et al., 2024）と整合する。対照的に、拡散モデルを用いる Corrector は高周波成分を強化し、特に強い降水の精度を改善した。これは物理ベース NWP における高解像度化が強雨予測を改善する（Kato, 2020）こととも整合する。事例解析（図 3, 図 4）とパワースペクトル解析（図 6）から、改善は下層の風や露点温度差など、豪雨予測に重要な変数で顕著である。

Predictor–Corrector と Predictor の RMSE 比較（図 7）から二点が示唆される。第一に、RMSE 改善は Predictor の高周波成分が不足する特定の変数に限られる。低周波構造の保持を定める雑音レベルは現状全変数で共通であるため、地表・下層の風や露点温度差のように真値で高周波成分が顕著な変数では改善が見られ、他では RMSE 劣化が起こりうる。Hess et al. (2024) のダウンスケーリングの知見とも合致する。各変数ごとに雑音レベルを調整すれば、Predictor の保持と精度改善のバランスが取りやすくなる可能性がある。第二に、高周波成分が改善した変数でも、RMSE 改善は限定的である。これは、豪雨域の形状・位置など低周波成分（RMSE への寄与が大きい）が Predictor から保持されるためである。

本研究は、決定論的予測モデルと拡散モデルの組み合わせがメソスケール天気予報、特に強雨で有効であることを示した。具体的には、Swin‑Unet（トランスフォーマベース）と拡散モデルの組み合わせで高周波成分を強化し、降水精度を改善した。重要な利点は柔軟性であり、両モデルを独立学習することで、決定論モデルの更新（新データでの再学習やアーキテクチャ変更）時に拡散モデルの再学習を不要とし、モデル開発・学習時の計算コストを低減できる。本研究は高品質な再解析 RCDSJRA‑55 を用いたが、実観測データでの検証は今後の重要課題である。

---

## 図 3

2019 年 10 月 25 日 00:00UTC の降水、925 hPa の風・混合比に関する比較。左：Predictor 単体、中：Predictor–Corrector（PMM 処理）、右：真値。赤楕円で示す領域で、Predictor–Corrector は混合比分布の収束がより明瞭。

---

## 図 4

各気象変数の予測比較。列は右から真値、Predictor–Corrector（Ens‑Mean）、Predictor–Corrector（Ens‑Sample）、Predictor 単体。行は上から 1000 hPa u 風、1000 hPa v 風、850 hPa 露点温度差、500 hPa 気温、500 hPa ジオポテンシャル高度。Ens‑Sample は微細構造をより良く表現。

---

## 図 5

各空間スケールと降水閾値（1, 10, 20, 30, 40, 50 kg m⁻² h⁻¹）における FSS の比較。Predictor–Corrector（PMM）の改善が広いスケールで顕著。100 km スケールで 24% 改善。

---

## 図 6

各変数のパワースペクトル密度（PSD）。赤線は 2×10⁻³ [km⁻¹]（空間スケール 500 km）を示す。Predictor–Corrector は小スケール（<500 km）で真値に近づき、Predictor 単体の小スケール減衰を緩和。顕著な改善は地表・1000 hPa の u, v 風、1000 hPa 露点温度差。

注: PDF テキスト抽出の都合で、図 6 周辺ページに由来する不可読文字列（軸ラベル等の断片）が原文抽出結果に含まれていましたが、図キャプションと本文に対応する意味内容は本訳に反映済みです。

---

## 図 7

各変数・気圧面の RMSE 比較。u 風、v 風、露点温度差の地表・925・1000 hPa でアンサンブル平均 RMSE は Predictor と同等。他の層・変数では Predictor–Corrector が劣る場合あり。

---

## 謝辞（Acknowledgments）

本研究は JST ムーンショット型研究開発事業（課題番号 JPMJMS2389）の支援を受けた。

---

## 参考文献（References）

- Bi, K., Xie, L., Zhang, H., Chen, X., Gu, X., & Tian, Q. (2023). Accurate medium-range global weather forecasting with 3D neural networks. Nature, 619, 533–538. doi:10.1038/s41586-023-06185-3
- Bischoff, T., & Deck, K. (2024). Unpaired downscaling of fluid flows with diffusion bridges. Artificial Intelligence for the Earth Systems. doi:10.1175/aies-d-23-0039.1
- Bonavita, M. (2024). On some limitations of current machine learning weather prediction models. Geophysical Research Letters, 51. doi:10.1029/2023GL107377
- Bouallègue, Z. B., et al. (2024). The rise of data-driven weather forecasting... BAMS. doi:10.1175/bams-d-23-0162.1
- Cao, H., et al. (2021). Swin-Unet... arXiv:2105.05537
- Charlton-Perez, A. J., et al. (2024). Do AI models produce better weather forecasts... npj Climate and Atmospheric Science, 7. doi:10.1038/s41612-024-00638-w
- Clark, A. J. (2017). Generation of ensemble mean precipitation forecasts... Weather and Forecasting, 32, 1569–1583. doi:10.1175/WAF-D-16-0199.1
- Couairon, G., et al. (2024). ArchesWeather & ArchesWeatherGen... arXiv:2412.12971
- Craig, G. C., & Selz, T. (2018). Mesoscale dynamical regimes in the midlatitudes. GRL, 45, 410–417. doi:10.1002/2017GL076174
- Dhariwal, P., & Nichol, A. (2021). Diffusion models beat GANs... arXiv:2105.05233
- Dosovitskiy, A., et al. (2020). An image is worth 16×16 words... arXiv:2010.11929
- Ebert, E. E. (2001). Ability of a poor man’s ensemble... Monthly Weather Review.
- Fan, C. M., Liu, T. J., & Liu, K. H. (2022). S‑UNet... ISCAS 2022, 2333–2337. doi:10.1109/ISCAS48785.2022.9937486
- Finn, T. S., et al. (2024). Generative diffusion for regional surrogate models... JAMES, 16. doi:10.1029/2024MS004395
- Hess, P., et al. (2024). Fast, scale-adaptive, and uncertainty-aware downscaling... arXiv:2403.02774
- Ho, J., Jain, A., & Abbeel, P. (2020). Denoising diffusion probabilistic models. arXiv:2006.11239
- Houze, R. A. (2004). Mesoscale convective systems (Vol. 42). doi:10.1029/2004RG000150
- Ishida, J., et al. (2022). ASUCA: The JMA operational non-hydrostatic model (Vol. 100). JMSJ. doi:10.2151/jmsj.2022-043
- Karras, T., Aittala, M., Aila, T., & Laine, S. (2022). Elucidating the design space of diffusion-based generative models. arXiv:2206.00364
- Kato, T. (2020). “線状降水帯（線状強雨帯）”に関する研究. JMSJ, 98, 485–509. doi:10.2151/jmsj.2020-029
- Kawase, H., et al. (2023). Historical regional climate changes in Japan... Progress in Earth and Planetary Science, 10. doi:10.1186/s40645-023-00536-4
- Lam, R., et al. (2023). Learning skillful medium-range global weather forecasting. Science, 382, 1416–1421.
- Liu, Z., et al. (2021). Swin Transformer V2... arXiv:2111.09883
- Mardani, M., et al. (2025). Residual corrective diffusion modeling... Communications Earth & Environment, 6, 124. doi:10.1038/s43247-025-02042-5
- Mittermaier, M. P. (2021). A “meta” analysis of the FSS... MWR, 149, 3491–3504. doi:10.1175/MWR-D-18-0106.1
- Orlanski, I. (1975). A rational subdivision of scales... BAMS, 56, 527–530.
- Pathak, J., et al. (2024). Kilometer-scale convection allowing model emulation... arXiv:2408.10958
- Price, I., et al. (2025). Probabilistic weather forecasting with machine learning. Nature, 637, 84–90. doi:10.1038/s41586-024-08252-9
- Roberts, N. M., & Lean, H. W. (2008). Scale-selective verification of rainfall accumulations... MWR, 136, 78–97. doi:10.1175/2007MWR2123.1
- Schumacher, R. S., & Johnson, R. H. (2005). Organization and environmental properties... Mon. Wea. Rev., 133, 961–976.
- Shi, W., et al. (2016). Real-time single image and video super-resolution... CVPR 2016, 1874–1883. doi:10.1109/CVPR.2016.207
- Song, Y., et al. (2021). Score-based generative modeling through SDEs. arXiv:2011.13456
